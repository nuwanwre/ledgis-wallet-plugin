"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _uuid=_interopRequireDefault(require("uuid"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var ecrx=function(){function a(b){_classCallCheck(this,a),this.webSocketURL=b.webSocketURL,this.clientId=_uuid["default"].v4(),this.connectWebSocket(b.callback)}return _createClass(a,[{key:"connectWebSocket",value:function(a){var b=this;this.webSocket=new WebSocket("".concat(this.webSocketURL,"/?id=").concat(this.clientId)),this.webSocket.onopen=function(){b.connected=!0},this.webSocket.onclose=function(){b.connected=!1},this.webSocket.onerror=function(a){console.error("ERR ecrx: ",a)},this.webSocket.onmessage=function(b){a(b)}}},{key:"getAccount",value:function(){var a={payload:{action:Actions.WALLET_LOGIN,callbackURL:this.webSocketURL},requestId:this.clientId};return Utils.generateDeepLink(a)}},{key:"handleResponse",value:function(a){throw alert(a),"Not implemented exception"}},{key:"sendResponse",value:function(a){this.webSocket.send(a)}},{key:"invokeWallet",value:function(a){return Utils.generateDeepLink(a)}}],[{key:"parseRequest",value:function(a){for(var b,c=/[?&]([^=#]+)=([^&#]*)/g,d={};b=c.exec(a);)d[b[1]]=b[2];var e=Utils.hexDecode(d.payload),f={payload:e,requestId:d.requestId};return f}}]),a}();exports["default"]=ecrx;var Utils=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"generateDeepLink",value:function(b){var c=a.hexEncode(JSON.stringify(b.payload));if(b.payload.action===Actions.WALLET_LOGIN)return"".concat(WalletConstants.WALLET_NAME,"://request?payload=").concat(c,"&requestId=").concat(b.requestId)}},{key:"hexEncode",value:function(a){var b,c,d="";for(c=0;c<a.length;c++)b=a.charCodeAt(c).toString(16),d+=("000"+b).slice(-4);return d}},{key:"hexDecode",value:function(a){var c,b=String.fromCharCode,d=a.match(/.{1,4}/g)||[],e="";for(c=0;c<d.length;c++)e+=b(parseInt(d[c],16));return JSON.parse(e)}}]),a}(),WalletConstants={WALLET_NAME:"sigprovider"},Actions={WALLET_LOGIN:"login"};